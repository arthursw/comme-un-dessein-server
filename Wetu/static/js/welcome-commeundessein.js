// Generated by CoffeeScript 1.12.7
(function() {
  var finished, loadLoginForm, nQuestions, nSections, sectionIndex, sliderSize, validateEmail;

  $.ajaxSetup({
    beforeSend: function(xhr, settings) {
      var getCookie;
      getCookie = function(name) {
        var cookie, cookieValue, cookies, i;
        cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          cookies = document.cookie.split(';');
          i = 0;
          while (i < cookies.length) {
            cookie = jQuery.trim(cookies[i]);
            if (cookie.substring(0, name.length + 1) === name + '=') {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
            i++;
          }
        }
        return cookieValue;
      };
      if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
        xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));
      }
    }
  });

  sectionIndex = 0;

  nQuestions = 4;

  nSections = 6;

  sliderSize = 250;

  finished = false;

  validateEmail = function(email) {
    var re;
    re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(email);
  };

  loadLoginForm = function() {
    finished = true;
    $.get("accounts/login/", (function(_this) {
      return function(data) {
        var doc, parser;
        parser = new DOMParser();
        doc = parser.parseFromString(data.html, "text/html");
        $('#login-form').html(doc.getElementById('login_form'));
        $('#id_login').attr('placeholder', "Nom d'utilisateur ou email");
        $('#id_username').attr('placeholder', "Nom d'utilisateur");
        $('label[for="id_remember"]').text('se souvenir de moi').css({
          'margin-left': '10px'
        }).parent().css({
          'display': 'flex',
          'flex-direction': 'row-reverse'
        });
        localStorage.setItem('just-logged-in', 'true');
        localStorage.setItem('selected-edition', location.pathname);
        $('#login-form').removeClass('hidden').show().addClass('visible');
      };
    })(this));
    return true;
  };

  $(document).ready(function() {
    var black, blue, brown, buttons, colors, green, justLoggedIn, red, white, yellow;
    red = '#F44336';
    blue = '#2196F3';
    green = '#8BC34A';
    yellow = '#FFC107';
    brown = '#795548';
    black = '#000000';
    white = '#FFFFFF';
    colors = [white];
    justLoggedIn = localStorage.getItem('just-logged-in') === 'true';
    if (justLoggedIn) {
      localStorage.removeItem('just-logged-in');
    }
    if (localStorage.getItem('selected-edition') !== null && justLoggedIn && $('.editions').attr('data-authenticated') === 'True') {
      window.location = localStorage.getItem('selected-edition');
      return;
    }
    buttons = $('.editions li').each((function(_this) {
      return function(index, element) {
        var buttonHref;
        buttonHref = $(element).find('a').attr('href');
        return $(element).click(function(e) {
          localStorage.setItem('selected-edition', buttonHref);
        });
      };
    })(this));
    $('#login-button').click(function(event) {
      $('#background').removeClass('hidden');
      loadLoginForm();
      event.stopPropagation();
      event.preventDefault();
      return -1;
    });
    document.addEventListener("click", function(event) {
      var loginForm, selectEditionForm;
      loginForm = $('#login-form');
      if (loginForm.get(0) !== event.target && (!jQuery.contains(loginForm.get(0), event.target)) && loginForm.hasClass('visible')) {
        loginForm.hide().removeClass('visible');
      }
      selectEditionForm = $('#select-edition');
      if (selectEditionForm.get(0) !== event.target && (!jQuery.contains(selectEditionForm.get(0), event.target)) && selectEditionForm.hasClass('visible')) {
        selectEditionForm.hide().removeClass('visible');
      }
      $('#background').addClass('hidden');
    });
    $('#app-button').click(function(event) {
      $('#select-edition').removeClass('hidden').show().addClass('visible');
      $('#background').removeClass('hidden');
      event.stopPropagation();
      event.preventDefault();
      return -1;
    });
    $('#id_email').on("change paste keyup", function() {
      var text;
      text = $(this).val();
      if (validateEmail(text)) {
        $('.cd-validate').removeClass('hidden').show();
      } else {
        $('.cd-validate').hide();
      }
    });
  });

}).call(this);
